buildscript {
  repositories {
    maven {
      url "https://plugins.gradle.org/m2/"
    }
  }
  dependencies {
    classpath "gradle.plugin.com.github.johnrengelman:shadow:7.1.2"
  }
}

plugins {
  id 'java'
  id 'application'
  id "com.github.johnrengelman.shadow" version "5.1.0"
}

sourceCompatibility = 11

subprojects.each { subproject ->
  evaluationDependsOn(subproject.path)
}

jar {
  from subprojects.sourceSets.main.output
}

repositories {
  mavenCentral()
}
dependencies {
  implementation group: 'com.github.spullara.cli-parser', name: 'cli-parser', version: '1.1.6'
}

mainClassName = "com.github.spullara.cli-parser"

project ("Triangle.Compiler") {
  repositories {
    mavenCentral()
  }
  dependencies {
    implementation group: 'com.github.spullara.cli-parser', name: 'cli-parser', version: '1.1.6'
  }
}

task fetchDependencies(dependsOn: configurations.compileClasspath, type: Copy) {
  from configurations.compileClasspath
  into "${buildDir}/cliFile"
}
build.dependsOn(fetchDependencies)

shadowJar {
  include "$buildDir/cliFile"
  include "cliFile"
  baseName = 'com.sampullara.cli.Args'
  version = project.version
  manifest {
    attributes 'Main-Class': mainClassName
  }
  from sourceSets.test.output.classesDirs
  mergeServiceFiles()
}